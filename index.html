<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web OS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="manifest" href="manifest.json">

    <link rel="stylesheet" href="styles.css">
    <style id="dynamic-theme-styles"></style>
</head>
<body class="bg-gray-900">

    <div id="animated-bg" class="zoomed-in"></div>

    <div id="onboarding-screen" class="screen fixed inset-0 z-40 flex items-center justify-center p-4">
        <div class="w-full max-w-sm md:max-w-3xl h-[600px] md:h-[450px] bg-pink-200 rounded-3xl shadow-2xl flex overflow-hidden border border-pink-300 backdrop-blur-md bg-opacity-80">
            <div id="onboarding-step-1" class="onboarding-step w-full h-full flex flex-col md:flex-row">
                <div class="w-full h-1/3 md:w-1/3 md:h-full">
                    <img src="https://i.pinimg.com/736x/32/8e/4d/328e4d26e5df09f223d762225afb923e.jpg" class="w-full h-full object-cover rounded-t-3xl md:rounded-l-3xl md:rounded-tr-none" alt="Abstract pink shapes">
                </div>
                <div class="w-full h-2/3 md:w-2/3 md:h-full p-6 md:p-8 flex flex-col">
                    <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">¡Bienvenido a tu nuevo espacio!</h2>
                    <p class="text-gray-600 mb-6">Personaliza tu experiencia eligiendo un color de acento que te represente.</p>
                    <div class="flex-grow flex items-center justify-center gap-4">
                        <button class="w-12 h-12 md:w-16 md:h-16 rounded-full bg-pink-400 transform hover:scale-110 transition-transform focus:outline-none focus:ring-4 ring-pink-300"></button>
                        <button class="w-12 h-12 md:w-16 md:h-16 rounded-full bg-rose-400 transform hover:scale-110 transition-transform focus:outline-none focus:ring-4 ring-rose-300"></button>
                        <button class="w-12 h-12 md:w-16 md:h-16 rounded-full bg-fuchsia-400 transform hover:scale-110 transition-transform focus:outline-none focus:ring-4 ring-fuchsia-300"></button>
                        <button class="w-12 h-12 md:w-16 md:h-16 rounded-full bg-purple-400 transform hover:scale-110 transition-transform focus:outline-none focus:ring-4 ring-purple-300"></button>
                        <button class="w-12 h-12 md:w-16 md:h-16 rounded-full bg-indigo-400 transform hover:scale-110 transition-transform focus:outline-none focus:ring-4 ring-indigo-300"></button>
                    </div>
                    <button data-next-step="2" class="onboarding-next-btn self-end w-14 h-14 bg-pink-500 text-white rounded-full hover:bg-pink-600 transition-colors shadow-lg flex items-center justify-center transform hover:scale-110">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                        </svg>
                    </button>
                </div>
            </div>
            <div id="onboarding-step-2" class="onboarding-step w-full h-full flex flex-col md:flex-row absolute inset-0 opacity-0 pointer-events-none">
                <div class="w-full h-1/3 md:w-1/3 md:h-full">
                    <img src="https://img.freepik.com/free-vector/smooth-pink-wavy-pattern-background_1017-14762.jpg" class="w-full h-full object-cover rounded-t-3xl md:rounded-l-3xl md:rounded-tr-none" alt="Abstract flowing lines">
                </div>
                <div class="w-full h-2/3 md:w-2/3 md:h-full p-6 md:p-8 flex flex-col">
                    <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">Acuerdos de Uso</h2>
                    <p class="text-gray-600 mb-4 flex-grow overflow-auto pr-2 text-sm">
                        Antes de continuar, por favor lee y acepta nuestros términos y condiciones. Este documento describe tus derechos y responsabilidades como usuario de nuestro sistema operativo web. Al hacer clic en "Aceptar y Continuar", confirmas que has leído, entendido y aceptado estar sujeto a estos términos. El uso continuado del servicio constituirá la aceptación de cualquier actualización futura de estos términos.
                    </p>
                    <button id="finish-onboarding-btn" class="self-end w-14 h-14 bg-pink-500 text-white rounded-full hover:bg-pink-600 transition-colors shadow-lg flex items-center justify-center transform hover:scale-110">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="login-screen" class="screen fixed inset-0 z-50 flex items-center justify-center p-4 opacity-0 pointer-events-none">
        <div class="relative w-full max-w-sm h-[500px]">
            <div id="login-step-1" class="login-step w-full h-full absolute top-0 left-0">
                <div class="w-full h-full p-8 bg-pink-200 rounded-3xl shadow-2xl flex flex-col items-center justify-center border border-pink-300 backdrop-blur-md bg-opacity-80">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2 text-center">¿Cómo quieres empezar?</h2>
                    <p class="text-gray-600 mb-8 text-center">Tus datos, a tu manera.</p>
                    <div class="w-full grid grid-cols-2 gap-4">
                        <button id="google-login-choice-btn" class="h-48 flex flex-col justify-between items-center bg-white/50 hover:bg-white/80 transition-all p-4 rounded-2xl shadow-md border border-white/60 transform hover:scale-105">
                            <span class="font-semibold text-gray-700">Cargando API...</span>
                            <svg class="w-16 h-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="#4285F4" d="M24 9.8c3.3 0 5.8 1.4 7.6 3.1l5.8-5.8C34.2 4.1 29.6 2 24 2 14.8 2 7.3 7.8 4 15.9l7 5.4c1.4-4.2 5.3-7.5 9.9-7.5z"/><path fill="#34A853" d="M24 46c5.5 0 10.2-1.9 13.6-5.1l-6.6-5.1c-1.8 1.2-4.1 2-6.9 2-4.6 0-8.5-3.3-9.9-7.5l-7 5.4C7.3 40.2 14.8 46 24 46z"/><path fill="#FBBC05" d="M14.1 28.2c-.5-1.5-.7-3.1-.7-4.8s.2-3.3.7-4.8l-7-5.4C5.5 16.4 4 20 4 24c0 4 .5 7.6 1.9 11.2l7.2-5.8z"/><path fill="#EA4335" d="M24 17.3c2.6 0 4.7.9 6.2 2.3l6-6C33.3 10.8 29.1 9 24 9c-8.2 0-15.2 5.7-18.1 13.5L13 28c1.3-4.4 5.3-7.7 11-7.7z"/><path fill="none" d="M2 2h44v44H2z"/></svg>
                        </button>
                        <button id="offline-login-choice-btn" class="h-48 flex flex-col justify-between items-center bg-white/50 hover:bg-white/80 transition-all p-4 rounded-2xl shadow-md border border-white/60 transform hover:scale-105">
                             <span class="font-semibold text-gray-700">Sin conexión</span>
                            <svg class="w-16 h-16 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>
                        </button>
                    </div>
                </div>
            </div>

            <div id="login-step-backup" class="login-step w-full h-full absolute top-0 left-0 opacity-0 pointer-events-none">
                <div class="w-full h-full p-8 bg-pink-200 rounded-3xl shadow-2xl flex flex-col items-center justify-center border border-pink-300 backdrop-blur-md bg-opacity-80">
                    <div id="backup-checker" class="text-center">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Buscando...</h2>
                        <p class="text-gray-600 mb-8">Revisando tu Google Drive por datos existentes.</p>
                        <div class="spinner mx-auto">
                            <div></div><div></div><div></div><div></div><div></div><div></div>
                        </div>
                    </div>
                    <div id="backup-restorer" class="hidden w-full text-center">
                         <h2 class="text-2xl font-bold text-gray-800 mb-2">¡Copia encontrada!</h2>
                         <p class="text-gray-600 mb-8">Hemos encontrado una copia de seguridad. ¿Quieres restaurarla y continuar donde lo dejaste?</p>
                         <div class="flex flex-col gap-4 w-full">
                            <button id="restore-backup-btn" class="w-full px-6 py-3 bg-pink-500 text-white rounded-full hover:bg-pink-600 transition font-semibold">Sí, restaurar datos</button>
                            <button id="skip-restore-btn" class="w-full px-6 py-3 bg-white/50 hover:bg-white/80 transition rounded-full text-gray-700 font-semibold">No, empezar de cero</button>
                         </div>
                    </div>
                </div>
            </div>

            <div id="login-step-2" class="login-step w-full h-full absolute top-0 left-0 opacity-0 pointer-events-none">
                 <div class="w-full h-full p-8 bg-pink-200 rounded-3xl shadow-2xl flex flex-col justify-between border border-pink-300 backdrop-blur-md bg-opacity-80">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-2 text-center">Crea tu perfil</h2>
                        <p class="text-gray-600 mb-8 text-center">Añade un nombre y una foto.</p>
                    </div>
                    <form id="username-form" class="w-full flex flex-col items-center">
                        <div class="relative mb-6">
                            <img id="profile-pic-preview" src="https://i.pravatar.cc/150?u=a042581f4e29026704d" alt="Foto de perfil" class="w-32 h-32 rounded-full object-cover shadow-lg border-4 border-white/50">
                            <label for="profile-pic-input" class="absolute bottom-0 right-0 w-10 h-10 bg-pink-500 rounded-full flex items-center justify-center text-white cursor-pointer hover:bg-pink-600 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.776 48.776 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z" /><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z" /></svg>
                            </label>
                            <input id="profile-pic-input" type="file" class="hidden" accept="image/*">
                        </div>
                        <input id="username-input" type="text" placeholder="Escribe tu nombre aquí" class="w-full text-center bg-white/70 border border-pink-200 rounded-lg py-3 px-4 focus:outline-none focus:ring-2 focus:ring-pink-400 text-gray-700" required>
                    </form>
                    <button id="username-submit-btn" class="self-end w-14 h-14 bg-pink-500 text-white rounded-full hover:bg-pink-600 transition-colors shadow-lg flex items-center justify-center transform hover:scale-110">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                        </svg>
                    </button>
                </div>
            </div>
            <div id="login-step-3" class="login-step w-full h-full absolute top-0 left-0 opacity-0 pointer-events-none">
                 <div class="w-full h-full p-8 bg-pink-200 rounded-3xl shadow-2xl flex flex-col justify-center border border-pink-300 backdrop-blur-md bg-opacity-80">
                    <div>
                        <h2 id="pin-greeting" class="text-2xl font-bold text-gray-800 mb-2 text-center">Crea tu PIN</h2>
                        <p id="pin-subtitle" class="text-gray-600 mb-8 text-center">Un PIN de 4 dígitos para tu seguridad.</p>
                        <div id="pin-dots-container" class="flex justify-center gap-4 mb-8">
                            <div class="pin-display-dot w-4 h-4 bg-white/50 rounded-full"></div>
                            <div class="pin-display-dot w-4 h-4 bg-white/50 rounded-full"></div>
                            <div class="pin-display-dot w-4 h-4 bg-white/50 rounded-full"></div>
                            <div class="pin-display-dot w-4 h-4 bg-white/50 rounded-full"></div>
                        </div>
                    </div>
                    <div id="pin-keypad" class="grid grid-cols-3 gap-4 w-max mx-auto">
                        </div>
                 </div>
            </div>
        </div>
    </div>


    <div id="main-content" class="opacity-0 pointer-events-none">
        <!-- Google Search Widget -->
        <div id="google-search-widget-container">
            <form id="google-search-form" class="google-search-form">
                <input type="text" id="google-search-input" placeholder="¿Te puedo ayudar?" autocomplete="off">
                
                <!-- Botones de búsqueda agrupados -->
                <div class="search-buttons-container">
                    <button type="button" id="gemini-search-button" title="Preguntar a Gemini">
                        <!-- Ícono de estrella para Gemini -->
                        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27z"/>
                        </svg>
                    </button>
                    <button type="submit" id="google-search-button" title="Buscar en Google">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    </button>
                </div>
            </form>
             <!-- Gemini Response Container -->
            <div id="gemini-response-container" class="hidden">
                 <div id="gemini-response-content">
                    <div id="gemini-loader" class="hidden">
                        <div class="gemini-spinner"></div>
                    </div>
                    <div id="gemini-response-text"></div>
                 </div>
                 <div id="gemini-actions" class="hidden">
                    <button id="gemini-copy-btn" title="Copiar respuesta">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                    </button>
                 </div>
            </div>
        </div>

        <main id="desktop" class="h-screen w-screen relative p-4 md:p-6 pt-24">
            <div id="app-window" class="hidden absolute bg-pink-50 rounded-2xl shadow-2xl flex flex-col overflow-hidden border border-pink-200">
                <header class="bg-pink-100 px-4 py-1 flex items-center justify-between border-b border-pink-200 cursor-move">
                    <div class="flex items-center gap-2">
                        <div id="window-icon" class="w-6 h-6"></div>
                        <h2 id="window-title" class="font-semibold text-gray-800">Nombre de la App</h2>
                    </div>
                    <div class="flex items-center gap-2">
                        <button id="maximize-window-btn" class="w-6 h-6 bg-green-300 rounded-full hover:bg-green-400 focus:outline-none focus:ring-2 focus:ring-green-200 transition-colors flex items-center justify-center"></button>
                        <button id="close-window-btn" class="w-6 h-6 bg-red-400 rounded-full hover:bg-red-500 focus:outline-none focus:ring-2 focus:ring-red-300 transition-colors"></button>
                    </div>
                </header>
                <div class="flex-grow rounded-b-2xl overflow-hidden flex items-center justify-center">
                    <div id="loader" class="spinner">
                        <div></div><div></div><div></div><div></div><div></div><div></div>
                    </div>
                    <iframe id="app-content-frame" src="about:blank" class="w-full h-full border-none app-content hidden" title="App Content"></iframe>
                </div>
            </div>

            <div id="settings-window" class="hidden absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-4xl h-[600px] bg-pink-50/80 backdrop-blur-xl rounded-2xl shadow-2xl flex overflow-hidden border border-pink-200">
                <div class="w-1/4 bg-black/5 p-4 flex flex-col gap-2">
                    <h2 class="text-lg font-bold text-gray-800 px-2 mb-4">Ajustes</h2>
                    <button data-section="account" class="settings-nav-btn active text-left w-full px-4 py-2 rounded-lg font-semibold text-gray-700 bg-black/10">Cuenta y Sesiones</button>
                    <button data-section="personalization" class="settings-nav-btn text-left w-full px-4 py-2 rounded-lg font-semibold text-gray-700 hover:bg-black/10">Personalización</button>
                    <button data-section="build" class="settings-nav-btn text-left w-full px-4 py-2 rounded-lg font-semibold text-gray-700 hover:bg-black/10">Detalles de Compilación</button>
                </div>

                <div class="w-3/4 p-8 overflow-y-auto">
                    <div id="settings-section-account" class="settings-section">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6">Cuenta y Sesiones</h3>
                        <div id="google-account-info" class="hidden flex items-center gap-4">
                            <img id="settings-pfp" src="" alt="User profile picture" class="w-20 h-20 rounded-full object-cover">
                            <div>
                                <h4 id="settings-username" class="text-xl font-semibold text-gray-700"></h4>
                                <p id="settings-email" class="text-gray-500"></p>
                                <p class="text-sm text-gray-500 mt-1">Conectado con Google</p>
                            </div>
                        </div>
                        <div id="offline-account-info" class="hidden flex items-center gap-4">
                            <img id="settings-pfp-offline" src="" alt="User profile picture" class="w-20 h-20 rounded-full object-cover">
                            <div>
                                <h4 id="settings-username-offline" class="text-xl font-semibold text-gray-700"></h4>
                                <p class="text-sm text-gray-500 mt-1">Sesión local sin conexión</p>
                            </div>
                        </div>
                    </div>

                    <div id="settings-section-personalization" class="settings-section hidden">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6">Personalización</h3>
                        <div class="space-y-6">
                            <div>
                                <label class="flex items-center justify-between cursor-pointer">
                                    <span class="font-semibold text-gray-700">Modo Adaptativo</span>
                                    <div class="relative">
                                        <input type="checkbox" id="adaptive-mode-toggle" class="sr-only peer" checked>
                                        <div class="w-14 h-8 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-1 after:left-1 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-green-400"></div>
                                    </div>
                                </label>
                                <p class="text-sm text-gray-500 mt-2">Sincroniza automáticamente los colores de la interfaz con tu fondo de pantalla.</p>
                            </div>
                            <div id="manual-color-picker" class="hidden">
                                <h4 class="font-semibold text-gray-700 mb-2">Color de Acento Manual</h4>
                                <p class="text-sm text-gray-500 mb-3">Elige un color cuando el modo adaptativo está desactivado.</p>
                                <div class="flex gap-3">
                                    <button data-color="pink" class="w-10 h-10 rounded-full bg-pink-400 transform hover:scale-110 transition-transform focus:outline-none focus:ring-4 ring-pink-300"></button>
                                    <button data-color="rose" class="w-10 h-10 rounded-full bg-rose-400 transform hover:scale-110 transition-transform focus:outline-none focus:ring-4 ring-rose-300"></button>
                                    <button data-color="fuchsia" class="w-10 h-10 rounded-full bg-fuchsia-400 transform hover:scale-110 transition-transform focus:outline-none focus:ring-4 ring-fuchsia-300"></button>
                                    <button data-color="purple" class="w-10 h-10 rounded-full bg-purple-400 transform hover:scale-110 transition-transform focus:outline-none focus:ring-4 ring-purple-300"></button>
                                    <button data-color="indigo" class="w-10 h-10 rounded-full bg-indigo-400 transform hover:scale-110 transition-transform focus:outline-none focus:ring-4 ring-indigo-300"></button>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-700 mb-2">Fondo de Pantalla Actual</h4>
                                <div id="current-wallpaper-preview" class="mb-4">
                                    </div>
                                <h4 class="font-semibold text-gray-700 mb-2">Seleccionar Nuevo Fondo</h4>
                                <div id="wallpaper-selection-grid" class="grid grid-cols-3 gap-4">
                                    <button class="aspect-video rounded-lg overflow-hidden focus:outline-none focus:ring-4 ring-offset-2 ring-blue-500 wallpaper-option">
                                        <img src="https://i.pinimg.com/736x/32/8e/4d/328e4d26e5df09f223d762225afb923e.jpg" class="w-full h-full object-cover">
                                    </button>
                                    <button class="aspect-video rounded-lg overflow-hidden focus:outline-none focus:ring-4 ring-offset-2 ring-blue-500 wallpaper-option">
                                        <img src="https://img.freepik.com/free-vector/smooth-pink-wavy-pattern-background_1017-14762.jpg" class="w-full h-full object-cover">
                                    </button>
                                    <button class="aspect-video rounded-lg overflow-hidden focus:outline-none focus:ring-4 ring-offset-2 ring-blue-500 wallpaper-option">
                                        <img src="https://c10.patreonusercontent.com/4/patreon-media/p/post/115987106/014a2a344eb04af0bd534066629930b5/eyJiIjo3MCwidyI6MTA4MH0%3D/1.gif?token-hash=FQipZ-GoI8DzRBu_sXt6i_LBQ2HyXOnQoWoL9BBK-aU%3D" class="w-full h-full object-cover">
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="settings-section-build" class="settings-section hidden">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6">Detalles de Compilación</h3>
                        <p class="text-gray-600">Información sobre la versión actual del sistema operativo web.</p>
                        <div class="mt-4 space-y-2 text-gray-700">
                            <p><span class="font-semibold">Versión:</span> 1.0.0-beta</p>
                            <p><span class="font-semibold">Fecha de Compilación:</span> 2024-05-21</p>
                            <p><span class="font-semibold">Frameworks:</span> TailwindCSS, Vanilla JS</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- POPUP DE TEMPORIZADOR Y CALENDARIO -->
            <div id="timer-window" class="popup-transition hidden absolute bottom-20 right-4 w-80 bg-pink-50/80 backdrop-blur-xl rounded-2xl shadow-2xl border border-pink-200 z-30 p-4">
                <!-- Botón de cierre para mantener la funcionalidad JS existente -->
                <button id="close-timer-window-btn" class="absolute top-2 right-2 w-7 h-7 flex items-center justify-center rounded-full hover:bg-black/10 transition-colors z-10">
                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
                
                <div class="space-y-4">
                    <div>
                        <h3 class="font-semibold text-gray-700 mb-2 text-sm">Temporizadores rápidos</h3>
                        <div class="grid grid-cols-4 gap-2">
                            <button data-time="5" class="timer-preset-btn w-full py-2 bg-pink-200 text-pink-700 rounded-lg hover:bg-pink-300 transition font-semibold text-xs shadow-sm">5 min</button>
                            <button data-time="10" class="timer-preset-btn w-full py-2 bg-pink-200 text-pink-700 rounded-lg hover:bg-pink-300 transition font-semibold text-xs shadow-sm">10 min</button>
                            <button data-time="15" class="timer-preset-btn w-full py-2 bg-pink-200 text-pink-700 rounded-lg hover:bg-pink-300 transition font-semibold text-xs shadow-sm">15 min</button>
                            <button data-time="30" class="timer-preset-btn w-full py-2 bg-pink-200 text-pink-700 rounded-lg hover:bg-pink-300 transition font-semibold text-xs shadow-sm">30 min</button>
                        </div>
                    </div>
                    <div id="calendar-container">
                        <div id="calendar-header" class="flex items-center justify-between mb-2 px-1">
                            <button id="prev-month-btn" class="w-7 h-7 flex items-center justify-center rounded-full hover:bg-black/10 transition-colors">&lt;</button>
                            <h3 id="month-year-display" class="font-bold text-base"></h3>
                            <button id="next-month-btn" class="w-7 h-7 flex items-center justify-center rounded-full hover:bg-black/10 transition-colors">&gt;</button>
                        </div>
                        <div id="calendar-grid" class="grid grid-cols-7 gap-1 text-center text-sm">
                            <!-- El calendario se generará aquí con JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

        </main>
        
        <div id="start-menu" class="hidden absolute bottom-20 left-4 w-96 h-auto bg-pink-100 rounded-2xl shadow-2xl p-4 flex flex-col justify-start border border-pink-200">
            <h2 id="greeting" class="text-3xl font-bold text-gray-800 text-center mb-4 animate-on-show"></h2>
            <div class="relative flex items-center justify-center mx-auto animate-on-show mb-4" style="--s: 220px;">
                <div class="wavy-circle-spinner shadow-md"></div>
                <img id="start-menu-avatar" src="https://i.pravatar.cc/180?u=eleanor" alt="User Avatar" class="absolute w-[180px] h-[180px] rounded-full object-cover shadow-lg border-4 border-pink-100">
            </div>
            
            <div class="grid grid-cols-2 gap-3 w-full animate-on-show mb-3">
                 <button id="save-cloud-btn" class="px-5 py-3 bg-pink-200 hover:bg-pink-300 transition rounded-full flex items-center justify-center text-pink-700 shadow-sm text-sm font-semibold gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 16.5V9.75m0 0l-3 3m3-3l3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33 3 3 0 013.758 3.848A3.752 3.752 0 0118 19.5H6.75z" /></svg>
                    Guardar en Google
                </button>
                 <button id="load-cloud-btn" class="px-5 py-3 bg-pink-200 hover:bg-pink-300 transition rounded-full flex items-center justify-center text-pink-700 shadow-sm text-sm font-semibold gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9.75v6.75m0 0l-3-3m3 3l3-3m-8.25 6a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33 3 3 0 013.758 3.848A3.752 3.752 0 0118 19.5H6.75z" /></svg>
                    Restaurar Google
                </button>
                 <button id="export-local-btn" class="px-5 py-3 bg-pink-200 hover:bg-pink-300 transition rounded-full flex items-center justify-center text-pink-700 shadow-sm text-sm font-semibold gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg>
                    Exportar Local
                </button>
                 <button id="import-local-btn" class="px-5 py-3 bg-pink-200 hover:bg-pink-300 transition rounded-full flex items-center justify-center text-pink-700 shadow-sm text-sm font-semibold gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" /></svg>
                    Importar Local
                </button>
            </div>

            <div class="grid grid-cols-2 gap-3 w-full animate-on-show">
                <button class="px-5 py-3 bg-pink-200 hover:bg-pink-300 transition rounded-full flex items-center justify-center text-pink-700 shadow-sm text-sm font-semibold gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg>
                    Apps
                </button>
                <button id="change-wallpaper-btn" class="px-5 py-3 bg-pink-200 hover:bg-pink-300 transition rounded-full flex items-center justify-center text-pink-700 shadow-sm text-sm font-semibold gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" /></svg>
                    Cambiar Fondo
                </button>
                <button id="settings-menu-btn" class="px-5 py-3 bg-pink-200 hover:bg-pink-300 transition rounded-full flex items-center justify-center text-pink-700 shadow-sm text-sm font-semibold gap-2">
                     <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06-.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                     Ajustes
                </button>
                <button id="logout-btn" class="px-5 py-3 bg-pink-200 hover:bg-pink-300 transition rounded-full flex items-center justify-center text-pink-700 shadow-sm text-sm font-semibold gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
                    Salir
                </button>
            </div>
        </div>

        <div id="drawer-indicator" class="fixed bottom-[78px] left-1/2 -translate-x-1/2 z-20 text-pink-200/50 pointer-events-none opacity-100 transition-opacity duration-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 15l7-7 7 7" />
            </svg>
        </div>

        <nav id="taskbar" class="fixed bottom-4 px-3 py-2 shadow-lg border border-pink-300 z-30">
            <div id="app-drawer-container" class="w-full h-full flex flex-col items-center justify-start relative">
                
                <div id="taskbar-visible-content" class="flex items-center justify-between w-full flex-shrink-0 h-[44px]">
                    <div class="flex items-center gap-3">
                        <button id="start-btn" class="pulsating-btn w-10 h-10 bg-white rounded-full shadow-lg focus:outline-none focus:ring-4 focus:ring-white/50 bg-cover bg-center" style="background-image: url('https://i.pravatar.cc/40?u=eleanor')"></button>
                        <div class="w-px h-6 bg-pink-300/50"></div>
                        <div id="taskbar-main-apps" class="flex items-center gap-3">
                            <button class="app-icon w-10 h-10 bg-rose-400 rounded-full flex items-center justify-center text-white text-xl shadow-md hover:scale-110 transition-transform focus:outline-none focus:ring-4 focus:ring-rose-300" data-url="./mytime/mytime.html" data-title="Navegador">
                                <img src="./mytime/favicon.png" alt="Navegador" class="w-full h-full object-cover rounded-full">
                            </button>
                            <button class="app-icon w-10 h-10 bg-fuchsia-400 rounded-full flex items-center justify-center text-white text-xl shadow-md hover:scale-110 transition-transform focus:outline-none focus:ring-4 focus:ring-fuchsia-300" data-url="./myroute/myroute.html" data-title="Música">
                                <img src="./myroute/favicon.png" alt="Música" class="w-full h-full object-cover rounded-full">
                            </button>
                            <button class="app-icon w-10 h-10 bg-purple-400 rounded-full flex items-center justify-center text-white text-xl shadow-md hover:scale-110 transition-transform focus:outline-none focus:ring-4 focus:ring-purple-300" data-url="./mymemory/mymemory.html" data-title="Archivos">
                                <img src="./mymemory/favicon.png" alt="Archivos" class="w-full h-full object-cover rounded-full">
                            </button>
                            <button class="app-icon w-10 h-10 bg-purple-400 rounded-full flex items-center justify-center text-white text-xl shadow-md hover:scale-110 transition-transform focus:outline-none focus:ring-4 focus:ring-purple-300" data-url="./mymood/mymood.html" data-title="Archivos">
                                <img src="./mymood/favicon.png" alt="Archivos" class="w-full h-full object-cover rounded-full">
                            </button>
                        </div>
                    </div>
                    <div id="clock-container" class="flex items-center gap-2">
                        <button id="clock-btn" class="focus:outline-none">
                            <div id="clock" class="bg-pink-100 text-gray-800 text-sm font-semibold px-4 py-1.5 rounded-full hover:bg-white/70 transition-colors"></div>
                        </button>
                    </div>
                </div>

                <div id="app-hub" class="w-full pt-4 flex-grow flex flex-col items-center opacity-0 pointer-events-none absolute top-[60px] left-0">
                    <div class="w-full max-w-md border-t border-pink-300/50 mb-4"></div>
                    <div class="w-full max-w-md text-center mb-4">
                        <h3 class="text-sm font-semibold text-gray-700">Mis Aplicaciones</h3>
                    </div>
                    <div id="custom-apps-grid" class="w-full max-w-md grid grid-cols-4 sm:grid-cols-5 gap-y-8 gap-x-4 px-2">
                         <div class="custom-app-item">
                            <button id="add-new-app-btn" class="w-full h-full flex flex-col items-center justify-center bg-black/5 hover:bg-black/10 rounded-2xl text-gray-600 transition p-2 aspect-square">
                                <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>
                                <span class="text-xs font-medium mt-1 text-center">Añadir App</span>
                            </button>
                        </div>
                        </div>
                </div>

            </div>
        </nav>
        
    </div>

    <!-- Píldora del temporizador -->
    <div id="timer-pill" class="timer-pill-base">
        <!-- El tiempo se insertará aquí vía JS -->
    </div>

    <div id="notification" class="notification-pill"></div>
    
    <div id="generic-modal" style="display: none;" class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
        <div class="w-full max-w-sm p-6 bg-pink-100 rounded-2xl shadow-2xl border border-pink-200 text-center">
            <h2 id="generic-modal-title" class="text-xl font-bold text-gray-800 mb-2"></h2>
            <div id="generic-modal-text"></div>
            <div id="generic-modal-buttons" class="mt-6 flex justify-center"></div>
        </div>
    </div>
    
    <!-- MEJORA: Menú contextual para aplicaciones -->
    <div id="app-context-menu" class="hidden absolute z-50">
        <button class="context-menu-btn" data-action="open-window">
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75" /></svg>
            <span>Abrir</span>
        </button>
        <button class="context-menu-btn" data-action="open-tab">
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-4.5 0V6.75A2.25 2.25 0 0011.25 4.5h-7.5" /></svg>
            <span>Abrir en pestaña</span>
        </button>
        <button class="context-menu-btn" data-action="add-desktop">
           <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 17.25v1.007a3 3 0 01-.879 2.122L7.5 21h9l-1.621-.621A3 3 0 0115 18.257V17.25m6-12V15a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 15V5.25A2.25 2.25 0 015.25 3h4.5M15 3h4.5a2.25 2.25 0 012.25 2.25v4.5" /></svg>
            <span>Añadir a escritorio</span>
        </button>
    </div>

    <input type="file" id="wallpaper-input" class="hidden" accept="image/jpeg, image/png, image/webp, image/gif">
    <!-- El script idb-keyval ya no se carga aquí, se carga dinámicamente en main.js -->
    <script type="module" src="./modules/main.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => console.log('Service Worker registrado con éxito:', registration.scope))
                    .catch(error => console.log('Error al registrar el Service Worker:', error));
            });
        }
    </script>
</body>
</html>
